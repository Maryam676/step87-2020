<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Enter Class</title>
    <!-- Firebase App (the core Firebase SDK) must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-app.js"></script>
    <!-- Firebase Authentication -->
    <script src="https://www.gstatic.com/firebasejs/7.15.1/firebase-auth.js"></script>
  </head>

  <script>
    function getQueue() {
      var params = window.location.search;
      const request = new Request("/get-queue" + params, {method: "GET"});
      document.getElementById('queue').innerHTML = "";

      fetch(request).then(response => response.json()).then((queue) => {
        const queueListElement = document.getElementById('queue');
        queue.forEach((name) => {
          queueListElement.appendChild(createListElement(name));
        })
      });
    }

    function notifyStudent(uEmail){
      var params = window.location.search + "&uEmail=" + uEmail;
      const request = new Request("/notify-student" + params, {method: "POST"});
      document.getElementById('beingHelped').appendChild(createHelpedElem(uEmail));
      
      fetch(request);

      getQueue();
    }

    function endHelp(uEmail){
      var params = window.location.search + "&uEmail=" + uEmail;
      const request = new Request("/end-help" + params, {method: "POST"});
      document.getElementById('beingHelped').innerHTML = "";
      
      fetch(request);

      getQueue();
    }

    function createListElement(text) {
      let notifyElem = document.createElement("div");

      let student = document.createElement('h1');
      student.innerText = text;

      let btn = document.createElement("input");
      btn.value = "notify student you're ready to help";
      btn.type = "button";
      btn.id = text;
      btn.onclick = function(){notifyStudent(this.id);};

      notifyElem.appendChild(student);
      notifyElem.appendChild(btn);

      return notifyElem;
    }

    function createHelpedElem(uEmail){
      let studentElem = document.createElement("div");

      let student = document.createElement('h1');
      student.innerText = "You are helping " + uEmail;

      let btn = document.createElement("input");
      btn.value = "end interaction";
      btn.type = "button";
      btn.id = uEmail;
      btn.onclick = function(){endHelp(this.id);};

      studentElem.appendChild(student);
      studentElem.appendChild(btn);

      return studentElem;
    }
  </script>

  <body onload="getQueue()">
    <h1>hello TA</h1>

    <div id = "beingHelped"></div>

    <div id="queue"></div>
  </body>
</html>